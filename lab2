DDL part 
-- 1. Create Tables

CREATE TABLE Airline_info (
    airline_id INT PRIMARY KEY,
    airline_code VARCHAR(30) NOT NULL,
    airline_name VARCHAR(50) NOT NULL,
    airline_country VARCHAR(50) NOT NULL,
    created_at TIMESTAMP NOT NULL,
    updated_at TIMESTAMP NOT NULL,
    info VARCHAR(50) NOT NULL
);

CREATE TABLE Airport (
    airport_id INT PRIMARY KEY,
    airport_name VARCHAR(50) NOT NULL,
    country VARCHAR(50) NOT NULL,
    state VARCHAR(50) NOT NULL,
    city VARCHAR(50) NOT NULL,
    created_at TIMESTAMP NOT NULL,
    updated_at TIMESTAMP NOT NULL
);

CREATE TABLE Passengers (
    passenger_id INT PRIMARY KEY,
    first_name VARCHAR(50) NOT NULL,
    last_name VARCHAR(50) NOT NULL,
    date_of_birth DATE NOT NULL,
    gender VARCHAR(50) NOT NULL,
    country_of_citizenship VARCHAR(50) NOT NULL,
    country_of_residence VARCHAR(50) NOT NULL,
    passport_number VARCHAR(20) NOT NULL,
    created_at TIMESTAMP NOT NULL,
    updated_at TIMESTAMP NOT NULL
);

CREATE TABLE Booking (
    booking_id INT PRIMARY KEY,
    flight_id INT NOT NULL,
    passenger_id INT NOT NULL,
    booking_platform VARCHAR(50) NOT NULL,
    created_at TIMESTAMP NOT NULL,
    updated_at TIMESTAMP NOT NULL,
    status VARCHAR(50) NOT NULL,
    price DECIMAL(7,2) NOT NULL
);

CREATE TABLE Flights (
    flight_id INT PRIMARY KEY,
    sch_departure_time TIMESTAMP NOT NULL,
    sch_arrival_time TIMESTAMP NOT NULL,
    departing_airport_id INT NOT NULL,
    arriving_airport_id INT NOT NULL,
    departing_gate VARCHAR(50) NOT NULL,
    arriving_gate VARCHAR(50) NOT NULL,
    airline_id INT NOT NULL,
    act_departure_time TIMESTAMP NOT NULL,
    act_arrival_time TIMESTAMP NOT NULL,
    created_at TIMESTAMP NOT NULL,
    updated_at TIMESTAMP NOT NULL
);

CREATE TABLE Baggage_check (
    baggage_check_id INT PRIMARY KEY,
    check_result VARCHAR(50) NOT NULL,
    created_at TIMESTAMP NOT NULL,
    updated_at TIMESTAMP NOT NULL,
    booking_id INT NOT NULL,
    passenger_id INT NOT NULL
);

CREATE TABLE Baggage (
    baggage_id INT PRIMARY KEY,
    weight_in_kg DECIMAL(4,2) NOT NULL,
    created_at TIMESTAMP NOT NULL,
    updated_at TIMESTAMP NOT NULL,
    booking_id INT NOT NULL
);

CREATE TABLE Boarding_pass (
    boarding_pass_id INT PRIMARY KEY,
    booking_id INT NOT NULL,
    seat VARCHAR(50) NOT NULL,
    boarding_time TIMESTAMP NOT NULL,
    created_at TIMESTAMP NOT NULL,
    updated_at TIMESTAMP NOT NULL
);

CREATE TABLE Booking_flight (
    booking_flight_id INT PRIMARY KEY,
    booking_id INT NOT NULL,
    flight_id INT NOT NULL,
    created_at TIMESTAMP NOT NULL,
    updated_at TIMESTAMP NOT NULL
);

CREATE TABLE Security_check (
    security_check_id INT PRIMARY KEY,
    check_result VARCHAR(20) NOT NULL,
    created_at TIMESTAMP NOT NULL,
    updated_at TIMESTAMP NOT NULL,
    passenger_id INT NOT NULL
);

-- 5. Rename airline_info to airline
ALTER TABLE Airline_info RENAME TO Airline;

-- 6. Rename column price â†’ ticket_price
ALTER TABLE Booking RENAME COLUMN price TO ticket_price;

-- 7. Change data type departing_gate to text
ALTER TABLE Flights ALTER COLUMN departing_gate TYPE TEXT;

-- 8. Drop column info
ALTER TABLE Airline DROP COLUMN info;

-- 9. Relationships
ALTER TABLE Security_check
    ADD CONSTRAINT fk_passenger_sec FOREIGN KEY (passenger_id) REFERENCES Passengers(passenger_id);

ALTER TABLE Booking
    ADD CONSTRAINT fk_passenger_booking FOREIGN KEY (passenger_id) REFERENCES Passengers(passenger_id);

ALTER TABLE Baggage_check
    ADD CONSTRAINT fk_passenger_baggage FOREIGN KEY (passenger_id) REFERENCES Passengers(passenger_id),
    ADD CONSTRAINT fk_booking_baggage FOREIGN KEY (booking_id) REFERENCES Booking(booking_id);

ALTER TABLE Baggage
    ADD CONSTRAINT fk_booking_bagg FOREIGN KEY (booking_id) REFERENCES Booking(booking_id);

ALTER TABLE Boarding_pass
    ADD CONSTRAINT fk_booking_boarding FOREIGN KEY (booking_id) REFERENCES Booking(booking_id);

ALTER TABLE Booking_flight
    ADD CONSTRAINT fk_booking_flight FOREIGN KEY (booking_id) REFERENCES Booking(booking_id),
    ADD CONSTRAINT fk_flight_booking FOREIGN KEY (flight_id) REFERENCES Flights(flight_id);

ALTER TABLE Flights
    ADD CONSTRAINT fk_dep_airport FOREIGN KEY (departing_airport_id) REFERENCES Airport(airport_id),
    ADD CONSTRAINT fk_arr_airport FOREIGN KEY (arriving_airport_id) REFERENCES Airport(airport_id),
    ADD CONSTRAINT fk_airline FOREIGN KEY (airline_id) REFERENCES Airline(airline_id);


DML part;
-- 1. Insert 200 random rows into Airport (example for PostgreSQL)
INSERT INTO Airport (airport_id, airport_name, country, state, city, created_at, updated_at)
SELECT g, 'Airport_' || g, 'Country_' || (g%10), 'State_' || (g%5), 'City_' || (g%20),
       NOW(), NOW()
FROM generate_series(1,200) g;

-- 2. Add new airline
INSERT INTO Airline (airline_id, airline_code, airline_name, airline_country, created_at, updated_at)
VALUES (1, 'KZ001', 'KazAir', 'Kazakhstan', NOW(), NOW());

-- 3. Update country
UPDATE Airline SET airline_country = 'Turkey' WHERE airline_name = 'KazAir';

-- 4. Insert 3 airlines at once
INSERT INTO Airline (airline_id, airline_code, airline_name, airline_country, created_at, updated_at) VALUES
(2, 'FR001', 'AirEasy', 'France', NOW(), NOW()),
(3, 'BR001', 'FlyHigh', 'Brazil', NOW(), NOW()),
(4, 'PL001', 'FlyFly', 'Poland', NOW(), NOW());

-- 5. Delete flights arriving in 2024
DELETE FROM Flights WHERE EXTRACT(YEAR FROM sch_arrival_time) = 2024;

-- 6. Increase ticket price by 15%
UPDATE Booking SET ticket_price = ticket_price * 1.15;

-- 7. Delete tickets cheaper than 10000
DELETE FROM Booking WHERE ticket_price < 1
